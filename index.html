<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chatran 🤖 — هوش مصنوعی فارسی</title>
<style>
body {
  background: linear-gradient(135deg, #00111c, #042a3c);
  font-family: "Vazirmatn", sans-serif;
  color: #e8f6ff;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  margin: 0;
}
#chatbox {
  width: 95%;
  max-width: 800px;
  height: 80vh;
  background: rgba(0, 20, 30, 0.7);
  border-radius: 15px;
  box-shadow: 0 0 10px #0ff4ff;
  padding: 15px;
  overflow-y: auto;
}
.message {
  margin: 6px 0;
  padding: 10px;
  border-radius: 10px;
  line-height: 1.6;
  max-width: 80%;
  white-space: pre-wrap;
}
.user {
  background: #143d52;
  align-self: flex-end;
  margin-left: auto;
}
.bot {
  background: #055c70;
  align-self: flex-start;
  margin-right: auto;
}
#inputRow {
  margin-top: 10px;
  display: flex;
  width: 95%;
  max-width: 800px;
}
#userInput {
  flex: 1;
  padding: 12px;
  border-radius: 10px;
  border: none;
  outline: none;
  background: #093143;
  color: #e8f6ff;
  font-size: 16px;
}
#sendBtn {
  background: #00c8ff;
  color: #002430;
  font-weight: bold;
  border: none;
  padding: 12px 25px;
  border-radius: 10px;
  margin-left: 8px;
  cursor: pointer;
  transition: 0.2s;
}
#sendBtn:hover { background: #00a2d6; }
</style>
</head>
<body>
<div id="chatbox"></div>
<div id="inputRow">
  <input id="userInput" placeholder="پیامتو بنویس..." autofocus>
  <button id="sendBtn">ارسال</button>
</div>

<script>
const chatbox = document.getElementById("chatbox");
const input = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");
let memory = JSON.parse(localStorage.getItem("chatran_memory") || "{}");
let history = JSON.parse(localStorage.getItem("chatran_history") || "[]");

// افزودن پیام به صفحه
function addMessage(text, cls) {
  const div = document.createElement("div");
  div.className = "message " + cls;
  div.textContent = text;
  chatbox.appendChild(div);
  chatbox.scrollTop = chatbox.scrollHeight;
}

// پاسخ هوشمند Chatran
function chatranResponse(msg) {
  msg = msg.toLowerCase().trim();

  const typoFix = {
    "مسلام": "سلام", "سلا": "سلام", "خدافظ": "خداحافظ", "چطوریی": "چطوری",
    "مرسیی": "مرسی", "قربونتت": "قربونت"
  };
  for (let key in typoFix) msg = msg.replace(key, typoFix[key]);

  let res = "";

  // درک سلام و احوالپرسی
  if (msg.includes("سلام")) res = "سلام! چطوری رفیق؟ 😄";
  else if (msg.includes("چطوری") || msg.includes("چه خبر")) res = "من خوبم، تو چطوری؟ چه خبر ازت؟";
  else if (msg.includes("خداحافظ")) res = "فعلاً! مراقب خودت باش 💫";
  else if (msg.includes("مرسی") || msg.includes("قربونت")) res = "فدای تو 💙";
  else if (msg.includes("کد") || msg.includes("برنامه") || msg.includes("html")) res = "می‌خوای برات یه کد بنویسم؟ بگو چی می‌خوای تا بسازم.";
  else if (msg.includes("اسم") && msg.includes("تو")) res = "من Chatran هستم، مدل زبانی ساخته‌ی پرهام 😎";
  else if (msg.includes("دوست") || msg.includes("عشق")) res = "❤️ همیشه باهاتم، رفیق!";
  else if (msg.includes("کی") && msg.includes("ساخت")) res = "منو پرهام ساخت 😎";
  else if (msg.includes("میفهمی") || msg.includes("می‌فهمی")) res = "آره، دارم کاملاً حرفتو تحلیل می‌کنم 🧠";
  else if (msg.includes("یاد") && msg.includes("بگیر")) res = "دارم یاد می‌گیرم. ازت ممنون بابت آموزش 🙏";
  else if (msg.includes("برنامه نویسی") || msg.includes("کد نویسی")) res = "من می‌تونم کد HTML, JS یا Python بنویسم، چی بسازم برات؟";
  else if (msg.includes("دوستت دارم")) res = "منم دوستت دارم 😍";
  else if (msg.includes("چی بلدی")) res = "من خیلی چیزا بلدم! از برنامه‌نویسی گرفته تا شوخی و مکالمه طبیعی 😄";
  else if (msg.includes("یاد")) res = "من همیشه از حرفات یاد می‌گیرم. هرچی بگی ذخیره می‌کنم 💾";
  else res = guessFromHistory(msg);

  // یادگیری از کاربر
  history.push({user: msg, bot: res});
  localStorage.setItem("chatran_history", JSON.stringify(history));
  return res;
}

// حدس از تاریخچه
function guessFromHistory(msg) {
  for (let h of history.reverse()) {
    if (msg.includes(h.user.split(" ")[0])) return "من یادم میاد قبلاً گفتی \"" + h.user + "\" و جوابم \"" + h.bot + "\" بود 😄";
  }
  return "متاسفانه من قدرت پردازش سوال شما را ندارم 🤖";
}

// ارسال پیام
function sendMessage() {
  const msg = input.value.trim();
  if (!msg) return;
  addMessage(msg, "user");
  input.value = "";
  setTimeout(() => {
    const res = chatranResponse(msg);
    addMessage(res, "bot");
  }, 400);
}

// رویدادها
sendBtn.onclick = sendMessage;
input.onkeypress = (e) => { if (e.key === "Enter") sendMessage(); };

// بارگذاری تاریخچه
for (let h of history) {
  addMessage(h.user, "user");
  addMessage(h.bot, "bot");
}
</script>
</body>
</html>
