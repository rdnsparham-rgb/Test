<!doctype html>
<html lang="fa">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>کلاینت سنگین برای مدل</title>
<style>
  body{font-family:sans-serif;display:flex;align-items:center;justify-content:center;height:100vh;margin:0;background:#0b1220;color:#e6edf3}
  #box{width:800px;background:#071227;padding:18px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,0.6)}
  textarea{width:100%;height:140px;padding:10px;border-radius:8px;border:1px solid #233446;background:#071723;color:#e6edf3}
  input,button{padding:8px;border-radius:8px;border:none}
  #log{height:240px;overflow:auto;background:#06111a;padding:10px;border-radius:8px;margin-top:10px;border:1px solid #123}
  .user{color:#9ad1ff}
  .bot{color:#b8f7c4}
</style>
</head>
<body>
<div id="box">
  <h2>ارسال پرامپت به سرور مدل سنگین</h2>
  <textarea id="prompt" placeholder="اینجا پرامپت رو بنویس..."></textarea>
  <div style="display:flex;gap:8px;margin-top:8px">
    <input id="max_length" type="number" value="256" style="width:100px" />
    <input id="temperature" type="number" step="0.1" value="0.8" style="width:100px" />
    <input id="top_p" type="number" step="0.01" value="0.9" style="width:100px" />
    <button id="send">ارسال</button>
    <button id="clear">پاک کردن</button>
  </div>
  <div id="status" style="margin-top:8px;font-size:13px;color:#9aa7b2">وضعیت: آماده</div>
  <div id="log"></div>
</div>

<script>
  const sendBtn = document.getElementById('send');
  const clearBtn = document.getElementById('clear');
  const log = document.getElementById('log');
  const status = document.getElementById('status');

  function append(text, cls='bot') {
    const d = document.createElement('div');
    d.className = cls;
    d.innerText = text;
    log.appendChild(d);
    log.scrollTop = log.scrollHeight;
  }

  sendBtn.onclick = async () => {
    const prompt = document.getElementById('prompt').value.trim();
    if(!prompt) return;
    const max_length = parseInt(document.getElementById('max_length').value) || 256;
    const temperature = parseFloat(document.getElementById('temperature').value) || 0.8;
    const top_p = parseFloat(document.getElementById('top_p').value) || 0.9;

    append("USER: " + prompt, 'user');
    status.innerText = 'در حال ارسال به سرور...';

    try {
      const res = await fetch('http://localhost:8000/generate', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({prompt, max_length, temperature, top_p})
      });

      const data = await res.json();
      if(data.error) {
        append("ERROR: " + data.error, 'bot');
        status.innerText = 'خطا';
      } else {
        append("MODEL: " + data.generated_text, 'bot');
        status.innerText = 'پایان تولید';
      }
    } catch (e) {
      append("شبکه/سرور خطا: " + e.message, 'bot');
      status.innerText = 'خطا در اتصال';
    }
  };

  clearBtn.onclick = () => log.innerHTML = '';
</script>
</body>
</html>
