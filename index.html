<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Chatran Node.js</title>
<style>
body { font-family:sans-serif; background:#0b1b2b; color:#e0f7fa; display:flex; flex-direction:column; align-items:center; }
#chatbox { width:80%; max-width:700px; height:70vh; background:#112f44; overflow-y:auto; padding:15px; border-radius:10px; margin-top:20px; }
.message { margin:5px 0; padding:10px; border-radius:10px; max-width:80%; }
.user { background:#065a82; align-self:flex-end; }
.bot { background:#0277bd; align-self:flex-start; }
#inputRow { display:flex; width:80%; max-width:700px; margin-top:10px; }
#userInput { flex:1; padding:10px; border-radius:10px; border:none; outline:none; background:#093143; color:#e0f7fa; }
#sendBtn { background:#00bcd4; color:#002430; border:none; padding:10px 20px; margin-left:5px; border-radius:10px; cursor:pointer; }
</style>
</head>
<body>

<div id="chatbox"></div>
<div id="inputRow">
  <input id="userInput" placeholder="پیامتو بنویس...">
  <button id="sendBtn">ارسال</button>
</div>

<script>
const input=document.getElementById("userInput");
const sendBtn=document.getElementById("sendBtn");
const chatbox=document.getElementById("chatbox");

function addMessage(text,cls){ const d=document.createElement("div"); d.className="message "+cls; d.textContent=text; chatbox.appendChild(d); chatbox.scrollTop=chatbox.scrollHeight; }

async function sendMessage(){
  const msg=input.value.trim();
  if(!msg) return;
  addMessage(msg,"user");
  input.value="";
  try{
    const res=await fetch('/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:msg})});
    const data=await res.json();
    addMessage(data.response,"bot");
  }catch(e){ addMessage("خطا در سرور","bot"); }
}

sendBtn.onclick=sendMessage;
input.onkeypress=(e)=>{if(e.key==="Enter") sendMessage();};
</script>

</body>
</html>
