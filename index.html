<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GPT-2 سنگین آفلاین</title>
<style>
body{font-family:sans-serif;background:#121212;color:#eee;display:flex;justify-content:center;align-items:center;height:100vh;margin:0}
#app{background:#1c1c1c;padding:20px;border-radius:12px;width:450px;box-shadow:0 0 20px rgba(0,0,0,0.7)}
textarea{width:100%;height:120px;padding:8px;border-radius:8px;border:none;background:#222;color:#eee;resize:none}
button{padding:8px 12px;margin-top:8px;border:none;border-radius:6px;background:#4caf50;color:white;cursor:pointer}
#messages{margin-top:10px;height:250px;overflow-y:auto;border:1px solid #333;padding:8px;border-radius:8px;}
.msg{margin:6px 0;padding:6px 10px;border-radius:6px;}
.user{background:#333;color:#8ef;text-align:left;}
.bot{background:#222;color:#8f8;text-align:left;}
</style>
</head>
<body>
<div id="app">
<h2>GPT-2 سنگین آفلاین</h2>
<textarea id="input" placeholder="پیام خود را بنویسید..."></textarea>
<button onclick="sendMessage()">ارسال</button>
<div id="messages"></div>
</div>

<script type="module">
// استفاده از transformers.js
import { AutoTokenizer, AutoModelForCausalLM } from "https://cdn.jsdelivr.net/npm/@xenova/transformers@2.5.0/dist/transformers.min.js";

let model, tokenizer;

const messages = document.getElementById('messages');

function addMessage(text, cls){
  const div = document.createElement('div');
  div.className = 'msg ' + cls;
  div.textContent = text;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

async function loadModel(){
  addMessage("در حال بارگذاری مدل... لطفاً صبور باشید", 'bot');
  tokenizer = await AutoTokenizer.from_pretrained("distilgpt2");
  model = await AutoModelForCausalLM.from_pretrained("distilgpt2");
  addMessage("مدل آماده است!", 'bot');
}

async function generateReply(prompt){
  const input_ids = await tokenizer.encode(prompt);
  const output_ids = await model.generate(input_ids, {max_length:100});
  const output_text = await tokenizer.decode(output_ids[0]);
  return output_text.length > prompt.length && output_text.startsWith(prompt) ? output_text.slice(prompt.length).trim() : output_text;
}

async function sendMessage(){
  const inputEl = document.getElementById('input');
  const text = inputEl.value.trim();
  if(!text) return;
  addMessage(text,'user');
  inputEl.value = '';
  addMessage("در حال تولید...",'bot');
  const reply = await generateReply(text);
  // پاک کردن پیام موقتی
  if(messages.lastChild.textContent === "در حال تولید...") messages.removeChild(messages.lastChild);
  addMessage(reply,'bot');
}

loadModel();
</script>
</body>
</html>
